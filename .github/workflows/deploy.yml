name: Deploy to Self-Hosted

on:
  push:
    branches: ["main"]

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Deploy to Production Folder
        run: |
          TARGET_DIR="/home/sam/epl-dashboard"

          if [ ! -d "$TARGET_DIR" ]; then
            echo "âŒ ë°°í¬ í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: $TARGET_DIR"
            exit 1
          fi

          rsync -av --delete \
          --exclude='.git' \
          --exclude='.github' \
          --exclude='.venv' \
          --exclude='__pycache__' \
          --exclude='logs' \
          --exclude='.env' \
          ./ "$TARGET_DIR/"

          cd "$TARGET_DIR"

          echo "ğŸ“¦ ì˜ì¡´ì„± ë™ê¸°í™” ì¤‘..."
          /home/sam/.local/bin/uv sync --no-dev

          echo "ğŸ”„ ì„œë¹„ìŠ¤ ì¬ì‹œì‘ ì¤‘..."
          pm2 startOrReload /home/sam/pm2.config.js --only epl-dashboard --update-env

          echo "ğŸ‰ ë°°í¬ ì™„ë£Œ!"
